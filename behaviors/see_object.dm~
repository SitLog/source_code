% See Object Task Dialogue Model
%
% 	Description	The robot sees an object in its current field of view
%	
%	Arguments	Sought: List of sought objects or label corresponding to a category of sought objects. 
%			If is a variable, it will search any known objects in the scene. 
%			
%			Mode: 	object .- search objects listed in the argument 'Sought' 
%				category .- search objects belonging to the category indicated in the argument 'Sought'
%	
%			Found_Objects: 	List of objects [ Object_1 , Object_2 , ... , Object_n ] where each object is a  
%					list which includes the ID and eight parameters about its position and orientation
%					[id,p1,p2,p3,p4,p5,p6,p7,p8]
%				 
%			Status:	
%				ok .- if at least one of the objects sought was found
%			       	not_found .- no objects sought were found
%				empty_scene .- if the robot is searching for any known objects but nothing was found

diag_mod(see_object(Sought, Mode, Found_Objects, Status),

	    [

		% Check 'Mode'(object or category)
		[
		 id ==> is,
		 type ==> neutral,

		 arcs ==> [		
					empty:empty => start_analyzing(Mode)
				    ]
		 ],

	    	
		[
		 id ==> start_analyzing(object),
		 type ==> neutral,

		 arcs ==> [		% Recognize objects specified directly in 'Sought'
					empty:empty => seeing(Sought)
				    ]
		 ],

		[
		 id ==> start_analyzing(category),
		 type ==> neutral,

		 arcs ==> [		% Recognize objects belonging to the categories listed in 'Sought'
					empty:empty => seeing( apply(get_objects_in_categories(S),[Sought] ) )
				    ]
		 ],

		% Seeing (wait for scene analysis to be completed)
		[
		 id ==> seeing(Objects),
		 type ==> object_analyzing,

		 arcs ==> [		% Recognize Object in current view
					objects(Scene):empty => check(apply(objects_in_scene(O, P), [Objects, Scene])),
					
					% empty scene
					nothing:empty => check(empty_scene),

					% Still analyzing
					analyzing:empty => seeing(Objects)

				    ]
		 ],

		% Check status: at least one object is found in scene
		[
		 id ==> check([object(Object_ID,X,Y,Z, RQ1,RQ2,RQ3,RQ4,Score)|Rest]),
		 type ==> neutral,

		 arcs ==> [		empty:empty=> success
				    ],

		 diag_mod ==> see_object(Sought, _, [object(Object_ID,X,Y,Z,RQ1,RQ2,RQ3,RQ4,Score)|Rest], ok)
		 ],


		% Check status: 'not_found' or 'empty_scene'
		[
		 id ==> check(Status),
		 type ==> neutral,

		 arcs ==> [		empty: empty => error
				    ],

		 diag_mod ==> see_object(Sought, _, _, Status)

		 ],

		% Final Situations
		[id ==> error, type ==> final],

		[id ==> success, type ==> final]

	    ], 

	% List of Local Variables
	[]

   ). 
