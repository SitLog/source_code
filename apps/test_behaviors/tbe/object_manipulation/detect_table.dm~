%%
diag_mod(detect_table,
[
     %% Initial situation. Golem keeps track (set flag true) 
     %% of the rotation angle (by adding the values to the corresponding
     %% global variables)
     [	
     id ==> is,
     type ==> neutral,
     arcs ==> [
               empty : [set(flag_angle_storing_groceries,true),
                        set(angle_operation,addition),
                        get(scan_st,Scan),
                        get(tilt_st,Tilt),
                        get(tbl_pts,Tbl_Pts) ] => find_tbl(Scan,Tilt,Tbl_Pts)
	      ]
     ],
     
     
     %%
     %% Find table
     [
     id ==> find_tbl(Scan,Tilt,Pts),
     type ==> recursive,
     embedded_dm ==> find(plane,X,Pts,Scan,Tilt,yolo,FndObjs,_,false,false,false,_), %% Attention!!
     arcs ==> [
               success : empty => approach_obj( apply(get_head(H),[FndObjs]) ),
               error   : [say('I found no plane')] => error
              ]
     ],
     

     %% If no object was to be taken since there was not object within range
     [
     id ==> approach_obj(empty_list),
     type ==> neutral,
     arcs ==> [
               empty : [say('No objects to take')] => error
	      ]     
     ],
     
     
     %% FndObjs is not a list
     [
     id ==> approach_obj(non_list),
     type ==> neutral,
     arcs ==> [
               empty : [say('No objects detected')] => error
	      ]     
     ],

   
     %
     [
     id ==> approach_obj(Object),
     type ==> recursive,
     embedded_dm ==> approach_object(Object,_,_),
     arcs ==> [
               success : [set(flag_angle_storing_groceries,false)] => por_definir,
               error   : [say('Problem approaching the table')] => error
              ]
     ],

     [
     ]
],

% Second argument: list of local variables
[
     scan_st ==> [0.0],
     tilt_st ==> [-30.0],
     tbl_pts ==> [turn=>(90.0),turn=>(90.0),turn=>(90.0)]
     %tbl_pts ==> [turn=>(90.0),turn=>(90.0),turn=>(90.0)]
     %tbl_pts ==> [[turn_precise=>(90.0),displace_precise=>(0.25)], [turn_precise=>(135.0),displace_precise=>(0.282),turn_precise=>(-45.0)], [turn_precise=>(135.0),displace_precise=>(0.282),turn_precise=>(-45.0)]]
]

).	
	
